---
trigger:
  batch: true
  branches:
    include:
      - master

pool:
  vmImage: "ubuntu-latest"

variables:
  - group: github

stages:
  - stage: "Docs"
    displayName: "Docs"
    condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
    jobs:
      - job: "Docs_MkDocs"
        displayName: "MkDocs"
        condition: eq(variables['Build.SourceBranch'], 'refs/heads/master')
        steps:
          - script: |
              sudo apt install -y git git-fast-import openssh-client
              pip install mkdocs mkdocs-material pymdown-extensions
            displayName: "Install"
          - script: |
              rm -f ~/.gitconfig && rm -Rf  ~/.ssh
              eval $(ssh-agent -s)
              mkdir -p ~/.ssh
              echo "$githubSSHPublicKey" > ~/.ssh/id_rsa.pub
              echo "$githubSSHPrivateKey" | ssh-add -
              ssh-keyscan github.com >> ~/.ssh/known_hosts
              git config --global user.email "$githubEmail"
              git config --global user.name "Git"
              git clone $GITHUB_URL git-src/ && cd git-src/
            displayName: "Setup"
          - script: |
              git status
              python --version
              pip --version
              cd docs
              python -m mkdocs gh-deploy -v -c -m "ðŸ“š Update docs"
            displayName: "MkDocs"
